      - name: Decode signing keystore
        env:
          KS_B64: ${{ secrets.KEYSTORE_BASE64 }}
          KS_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: |
          set -euo pipefail
          if [[ -z "${KS_B64:-}" ]]; then
            echo "::warning::Keystore secret is empty - build will be unsigned"
            echo "::notice::To enable signing, set KEYSTORE_BASE64 secret"
            exit 0
          fi
          
          val="${KS_B64#base64:}"; val="${val#base64,}"
          val="$(printf '%s' "$val" | tr -d ' \n\r\t')"
          
          if printf '%s' "$val" | base64 -d > release.keystore 2>/dev/null; then
            echo "✅ Keystore decoded successfully"
          else
            echo "::error::Invalid Base64 in keystore secret"
            echo "::error::Ensure the secret contains valid base64-encoded keystore data"
            exit 1
          fi
          
          if [[ -f release.keystore ]]; then
            {
              echo "MYAPP_UPLOAD_STORE_FILE=$PWD/release.keystore"
              echo "MYAPP_UPLOAD_STORE_PASSWORD=${KS_PASSWORD}"
              echo "MYAPP_UPLOAD_KEY_ALIAS=${KEY_ALIAS}"
              echo "MYAPP_UPLOAD_KEY_PASSWORD=${KEY_PASSWORD}"
            } >> "$GITHUB_ENV"
            echo "✅ Signing configuration applied"
          else
            echo "::warning::Keystore file not found - build will be unsigned"
          fi
